# User Functions
Provides capabilities to work with users. It is basically an interface between the app and the underlying Room database that the library uses.

#### Getting an instance of `UserFunctions`
Simply call the following (but this requires the `NotesCore` library to be initialized).
```kotlin
val userFunctions = NotesCore.userFunctions()
```

#### Understanding the flow
While you are free to implement your own flow, the expected way to implement a flow is as follows:
* When the app launches, we must first check if an user was previously logged in. This can be done using the `userFunctions.getCurrentlyLoggedInUser()` function. 
  * If this returns `null`, that means no user was previously logged in (or previously logged in user's session has expired) and a login/register page must be shown.
  * If this returns an `User` object, that means an user was previously logged in and we can use this `User` object to proceed.
* If we are showing the login page (because previous step returned `null`), then we must request the `username` and `password` from the user as input.
  * To verify if the `username` and the `password` entered is correct, we can call `userFunctions.authenticateUser(username, password)`. If this returns `null` then the `username` and `password` combination is incorrect and the user must try again. If this returns `User` object, then authentication is successful and we can proceed with this user.
  * To complete the login flow, please call `userFunctions.loginUser(user)` with the above `User` object (if authentication was successful). This creates a session internally and will allow the `userFunctions.getCurrentlyLoggedInUser()` to return this `User` object later.
* If we are showing the register page, then we must request `username`, `displayName` and `password` from the user as input.
  * `username` is unique and entering duplicate will be rejected (will be explained later).
  * `displayName` is the name of the user that can be displayed.
  * `password` is the password that the user must provide for authentication.
  * To register, we must call `userFunction.registerUser(username, displayName, password)`. If this returns `null`, it means that the entered `username` is already registered and the user must enter a different username. If this returns an `User` object, it means the user registration was successful and this `User` object can be used to directly login (by calling the `userFunctions.loginUser(user)`) or user can be requested to login again.
* Finally, if we want to logout an user who is already logged in, we can call the `userFunctions.logoutUser(user)`.
  * We should pass the `User` object acquired previously (from `userFunctions.getCurrentlyLoggedInUser()` or `userFunctions.authenticateUser(username, password)`) into this function.

All the functions mentioned above are `suspend` functions and must be called within a `CoroutineScope`. In jetpack compose, this can be done by:
```kotlin
// Inside a composable
val scope = rememberCoroutineScope()
// ... //
scope.launch {
    // Call any of the UserFunction functions here
}
```

An example usage of all the above functions can be found [here](../app/src/main/java/com/corphish/notessample/MainActivity.kt).

#### What is inside the `User` class
The `User` class is basically a data class that holds user details:
* `id` - Id of this user (auto generated).
* `username` - The username of this user.
* `displayName` - The display name of this user.
* `passwordHash` - Password hash generated by the library using the user input for password. This is for encryption purposes.
* `salt` - The salt is used to generate the above password hash and is provided by the library.

Out of the above parameters, the `username` and the `displayName` field is directly determined by the user input and the `passwordHash` is partially determined by the user input.

#### Next steps
With the `User` object acquired from above steps, we can use this to perform note related functions. Details about the note related functions can be found [here](NoteFunctions.md). If you are planning to perform the note related functions in a different activity, then the acquired `User` object can be easily passed onto different activity.
```kotlin
// From activity where the user object is acquired
val intent = Intent(this, NotesActivity::class.java)

// Key is specific to activity, user is the User object
intent.putExtra(NotesActivity.KEY_USER, user)
startActivity(intent)
```

And then,
```kotlin
// In the receiver activity
val user = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
    intent.getParcelableExtra(KEY_USER, User::class.java)
} else {
    intent.getParcelableExtra(KEY_USER)
}
```

Examples for activity where the user object is acquired can be found [here](../app/src/main/java/com/corphish/notessample/MainActivity.kt) and the receiver activity can be found [here](../app/src/main/java/com/corphish/notessample/NotesActivity.kt).